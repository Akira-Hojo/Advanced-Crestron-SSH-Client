#DEFAULT_VOLATILE
#ENABLE_STACK_CHECKING
#ENABLE_TRACE
                                               
#USER_SIMPLSHARP_LIBRARY "SSHClient"

// module inputs
Digital_Input init, connect, disconnect, debug, _skip_;
String_Input tx$[250], _skip_, hostname[50], username[20], password[20], debug_name[10];

// module outputs      
Digital_Output initialized_fb, connected_fb;
String_Output _skip_,_skip_,_skip_, rx$, _skip_;

// global variables
Integer connected;
SSHClientDevice client;

Function RegisterDelegates()
{
 	RegisterDelegate(client,SshRxDataToSimpl,DataRx);
	RegisterDelegate(client,SshStateChangeToSimpl,StatusRx);
}

Callback Function DataRx(string data)
{
	rx$ = data;	 	
}

Callback Function StatusRx(integer status)
{
	connected = status;
	connected_fb = status;
}

push init
{
	client.Initialize(hostname, username, password, debug_name);
}
                                   
Push connect
{
	client.Connect();
}

Push disconnect
{
 	client.Disconnect();
}

push debug
{
	client.debug_enable = 1;
}
release debug
{
	client.debug_enable = 0;
}

Threadsafe Change tx$
{
	// only send commands when connected
	if (connected)
		client.SendCommand(tx$);
}

Function Main()
{
 	WaitForInitializationComplete();
	RegisterDelegates();
}                    
